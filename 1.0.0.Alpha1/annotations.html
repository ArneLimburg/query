<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html
  PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"><head><title xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory">Chapter 4. Query Annotations</title><link rel="stylesheet" href="css/cambridge.css" type="text/css"/><meta xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" name="generator" content="DocBook XSL Stylesheets V1.74.0"/><link rel="home" href="index.html" title="CDI Query Module"/><link rel="up" href="index.html" title="CDI Query Module"/><link rel="prev" href="methodexpressions.html" title="Chapter 3. Query Method Expressions"/><link rel="next" href="criteria.html" title="Chapter 5. JPA Criteria API Support"/></head><body><p id="title"><a href="http://www.ctp-consulting.com" class="site_href"><strong>Cambridge Technology Partners</strong></a><a href="http://www.ctp-consulting.com" class="doc_href"><strong>Community Documentation</strong></a></p><ul class="docnav"><li class="previous"><a accesskey="p" href="methodexpressions.html"><strong>Prev</strong></a></li><li class="next"><a accesskey="n" href="criteria.html"><strong>Next</strong></a></li></ul><div class="chapter" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="annotations"/>Chapter 4. Query Annotations</h2></div></div></div><div class="toc"><dl><dt><span class="section"><a href="annotations.html#annotations-usage">4.1. Using Query Annotations</a></span></dt><dt><span class="section"><a href="annotations.html#annotations-options">4.2. Annotation Options</a></span></dt></dl></div><p>
        While method expressions are fine for simple queries, they will often reach their limit once things get slightly
        more complex. Another aspect is the way you want to use JPA: The recommended approach using JPA for best performance is over
        named queries. To help incorporate those use cases, the CDI Query module supports also annotating methods for
        more control on the generated query.
    </p><div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="annotations-usage"/>4.1. Using Query Annotations</h2></div></div></div><p>
            The simples way to define a specific query is by annotation a method and providing the JPQL query string which
            has to be executed. In code, this looks like the following sample:
        </p><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_keyword">public</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_keyword">interface</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_type">PersonDao</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_keyword">extends</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_type">EntityDao</span><!-- <br/> --><span class="java_operator">&lt;</span><!-- <br/> --><span class="java_type">Person</span><!-- <br/> --><span class="java_separator">,</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_type">Long</span><!-- <br/> --><span class="java_operator">&gt;</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">Query</span><span class="java_separator">(</span><span class="java_literal">&quot;select&nbsp;count(p)&nbsp;from&nbsp;Person&nbsp;p&nbsp;where&nbsp;p.age&nbsp;&gt;&nbsp;?1&quot;</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_type">Long</span><span class="java_plain">&nbsp;countAllOlderThan</span><span class="java_separator">(</span><span class="java_type">int</span><span class="java_plain">&nbsp;minAge</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_separator">}</span><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span></pre><p>
            The parameter binding in the query corresponds to the argument index in the method.
        </p><p>
            You can also refer to a named query which is constructed and executed automatically. The <code class="literal">@Query</code>
            annotation has a <code class="literal">named</code> attribute which corresponds to the query name:
        </p><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_plain">@</span><!-- <br/> --><span class="java_type">Entity</span>
<!--  --><br/><span class="java_plain">@</span><span class="java_type">NamedQueries</span><span class="java_separator">({</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">NamedQuery</span><span class="java_separator">(</span><span class="java_plain">name&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_type">Person</span><span class="java_separator">.</span><span class="java_plain">BY_MIN_AGE</span><span class="java_separator">,</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;query&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;select&nbsp;count(p)&nbsp;from&nbsp;Person&nbsp;p&nbsp;where&nbsp;p.age&nbsp;&gt;&nbsp;?1&nbsp;order&nbsp;by&nbsp;p.age&nbsp;asc&quot;</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_separator">})</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_type">Person</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">static</span><span class="java_plain">&nbsp;</span><span class="java_keyword">final</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;BY_MIN_AGE&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;person.byMinAge&quot;</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">...</span>
<!--  --><br/><span class="java_separator">}</span>
</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">interface</span><span class="java_plain">&nbsp;</span><span class="java_type">PersonDao</span><span class="java_plain">&nbsp;</span><span class="java_keyword">extends</span><span class="java_plain">&nbsp;</span><span class="java_type">EntityDao</span><span class="java_operator">&lt;</span><span class="java_type">Person</span><span class="java_separator">,</span><span class="java_plain">&nbsp;</span><span class="java_type">Long</span><span class="java_operator">&gt;</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">Query</span><span class="java_separator">(</span><span class="java_plain">named&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_type">Person</span><span class="java_separator">.</span><span class="java_plain">BY_MIN_AGE</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_type">Long</span><span class="java_plain">&nbsp;countAllOlderThan</span><span class="java_separator">(</span><span class="java_type">int</span><span class="java_plain">&nbsp;minAge</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_separator">}</span><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span></pre><p>
            Same as before, the parameter binding correspons to the argument index in the method. If the named query requires
            named parameters to be used, this can be done by annotating the arguments with the <code class="literal">@QueryParam</code>
            annotation.
        </p><div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="tip"><h2>Tip</h2>
            Java does not preserve method parameter names, that's why the annotation is needed.
        </div><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_plain">@</span><!-- <br/> --><span class="java_type">NamedQuery</span><!-- <br/> --><span class="java_separator">(</span><!-- <br/> --><span class="java_plain">name&nbsp;</span><!-- <br/> --><span class="java_operator">=</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_type">Person</span><!-- <br/> --><span class="java_separator">.</span><!-- <br/> --><span class="java_plain">BY_MIN_AGE</span><!-- <br/> --><span class="java_separator">,</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;query&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;select&nbsp;count(p)&nbsp;from&nbsp;Person&nbsp;p&nbsp;where&nbsp;p.age&nbsp;&gt;&nbsp;:minAge&nbsp;order&nbsp;by&nbsp;p.age&nbsp;asc&quot;</span><span class="java_separator">)</span>
</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">interface</span><span class="java_plain">&nbsp;</span><span class="java_type">PersonDao</span><span class="java_plain">&nbsp;</span><span class="java_keyword">extends</span><span class="java_plain">&nbsp;</span><span class="java_type">EntityDao</span><span class="java_operator">&lt;</span><span class="java_type">Person</span><span class="java_separator">,</span><span class="java_plain">&nbsp;</span><span class="java_type">Long</span><span class="java_operator">&gt;</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">Query</span><span class="java_separator">(</span><span class="java_plain">named&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_type">Person</span><span class="java_separator">.</span><span class="java_plain">BY_MIN_AGE</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_type">Long</span><span class="java_plain">&nbsp;countAllOlderThan</span><span class="java_separator">(</span><span class="java_plain">@</span><span class="java_type">QueryParam</span><span class="java_separator">(</span><span class="java_literal">&quot;minAge&quot;</span><span class="java_separator">)</span><span class="java_plain">&nbsp;</span><span class="java_type">int</span><span class="java_plain">&nbsp;minAge</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_separator">}</span><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span></pre></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="annotations-options"/>4.2. Annotation Options</h2></div></div></div><p>
            Beside providing a query string or reference, the <code class="literal">@Query</code> annotation provides also two more
            attributes:
        </p><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_keyword">public</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_keyword">interface</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_type">PersonDao</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_keyword">extends</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_type">EntityDao</span><!-- <br/> --><span class="java_operator">&lt;</span><!-- <br/> --><span class="java_type">Person</span><!-- <br/> --><span class="java_separator">,</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_type">Long</span><!-- <br/> --><span class="java_operator">&gt;</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">Query</span><span class="java_separator">(</span><span class="java_plain">named&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_type">Person</span><span class="java_separator">.</span><span class="java_plain">BY_MIN_AGE</span><span class="java_separator">,</span><span class="java_plain">&nbsp;max&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_literal">10</span><span class="java_separator">,</span><span class="java_plain">&nbsp;lock&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_type">LockModeType</span><span class="java_separator">.</span><span class="java_plain">PESSIMISTIC_WRITE</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_type">List</span><span class="java_operator">&lt;</span><span class="java_type">Person</span><span class="java_operator">&gt;</span><span class="java_plain">&nbsp;findAllForUpdate</span><span class="java_separator">(</span><span class="java_type">int</span><span class="java_plain">&nbsp;minAge</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_separator">}</span><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span></pre><p>
            </p><div class="informaltable"><table border="1"><colgroup><col/><col/></colgroup><thead><tr><th>Name</th><th>Description</th></tr></thead><tbody><tr><td><code class="literal">max</code></td><td>
                                Limits the number of results.
                            </td></tr><tr><td><code class="literal">lock</code></td><td>
                                Use a specific <code class="literal">LockModeType</code> to execute the query.
                            </td></tr></tbody></table></div><p>
            Note that these options can also be applied to <a class="xref" href="methodexpressions.html" title="Chapter 3. Query Method Expressions">Chapter 3, <i>Query Method Expressions</i></a>
        </p></div></div><ul class="docnav"><li class="previous"><a accesskey="p" href="methodexpressions.html"><strong>Prev</strong>Chapter 3. Query Method Expressions</a></li><li class="up"><a accesskey="u" href="#"><strong>Top of page</strong></a></li><li class="home"><a accesskey="h" href="index.html"><strong>Front page</strong></a></li><li class="next"><a accesskey="n" href="criteria.html"><strong>Next</strong>Chapter 5. JPA Criteria API Support</a></li></ul></body></html>